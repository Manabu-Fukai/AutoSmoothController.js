/*
----------------------------------------------------------
* jQuery AutoSmoothController 1.0
* (https://github.com/Manabu-Fukai/AutoSmothController.js)
*
* Copyright(c) 2014 Manabu Fukai
* Licensed under the MIT license.
*
* Depends:
*  jQuery UI
*  jQuery UI Touch Punch
*  jQuery Cookie Plugin
---------------------------------------------------------
*/
(function($){WindowH=$(window).height(),WindowW=$(window).width();var deviceW,deviceH;$.fn.autoSmoothController=function(options){var options=$.extend({target:'.section',speed:1200,distance:0,stick:[false,'outer'],setX:'right',setY:'top',manualX:0,manualY:null,addLast:true,easing:'swing',autoStrings:true,maxStrings:15,autoReverse:true,dataname:'asc',message:'section',draggable:true,axis:false,period:14,customClass:'default'},options);var navi=$(this),scrollNavi,targetObj=$(options.target).length,tips='.tips';var setup=function(){return $.Deferred(function(df){navi.append("<ul id='control' />");scrollNavi=$('#control');scrollNavi.append("<li id='topback'><p class='tips'></p></li>");for(var n=1;n<=targetObj;n++){scrollNavi.append("<li><p class='tips'></p></li>")}df.resolve()})};setup().promise().done(function(){scrollNaviHeight=scrollNavi.outerHeight(true);scrollNaviWidth=scrollNavi.outerWidth();if(options.setX==='left'){scrollNavi.addClass('reverse')}if($.cookie('ascLeft')!==undefined){var ascPosLeft,ascPosTop;if($.cookie('ascLeft')>WindowW){ascPosLeft=WindowW-scrollNaviWidth}else{ascPosLeft=parseInt($.cookie('ascLeft'))}if($.cookie('ascTop')>WindowH){ascPosTop=WindowH-scrollNaviHeight}else{ascPosTop=parseInt($.cookie('ascTop'))}scrollNavi.css({left:ascPosLeft,top:ascPosTop})}else if(!options.manualY){scrollNavi.css({top:[WindowH-scrollNaviHeight]/2})}else if(options.manualY!==null){if(options.setY==='top'){scrollNavi.css({top:options.manualY})}else if(options.setY==='bottom'){scrollNavi.css({top:WindowH-scrollNaviHeight-options.manualY})}}if(options.manualX&&options.stick[0]!==true){if(options.setX==='left'){scrollNavi.css({left:options.manualX})}else if(options.setX==='right'){scrollNavi.css({left:WindowW-scrollNaviWidth-options.manualX})}}if(options.stick[0]){var parentEl=$(options.stick[0]),parentWidth=parentEl.outerWidth(),parentLeft=parentEl.offset().left;stickPosition()}function stickPosition(){if($.cookie('ascLeft')!==undefined||$.cookie('ascTop')!==undefined)return;if(options.setX==='left'){if(options.stick[1]==='inner'){scrollNavi.css({left:parentLeft})}else{scrollNavi.css({left:parentLeft-scrollNaviWidth})}}else if(options.setX==='right'){if(options.stick[1]==='inner'){scrollNavi.css({left:parentLeft+parentWidth-scrollNaviWidth})}else{scrollNavi.css({left:parentLeft+parentWidth})}}}scrollNavi.children('li').each(function(i){if(i==0){$(this).children(tips).text('Page Top')}else{var myself=scrollNavi.children('li').index(this),strTrg=$(options.target).eq(myself-1),str=strTrg.html();var targetLeng,targetName;if(options.autoStrings){if($(options.target).eq(myself-1).data(options.dataname)){targetName=strTrg.data(options.dataname)}else{targetLeng=strTrg.html(str).text().length;targetName=strTrg.html(str).text().substr(0,(options.maxStrings));if(targetLeng>targetName.length)targetName+='…'}}else{targetName=strTrg.data(options.dataname)}if(typeof targetName!=='undefined'){$(this).children(tips).text(targetName)}else{targetName=options.message+i;$(this).children(tips).text(targetName)}}});});var navTop=scrollNavi.css('top'),navLeft=scrollNavi.css('left');if(options.draggable){scrollNavi.draggable({containment:'body',scroll:false,axis:options.axis,stop:function(event,ui){if(options.autoReverse&&options.setX==='right'){if($(this).position().left<WindowW/2){$(this).addClass('reverse')}else{$(this).removeClass('reverse')}}else if(options.autoReverse&&options.setX==='left'){if($(this).position().left>WindowW/2){$(this).removeClass('reverse')}else{$(this).addClass('reverse')}}$.cookie('ascLeft',ui.position.left,{expires:options.period,path:'/'});$.cookie('ascTop',ui.position.top,{expires:options.period,path:'/'})}})}else{scrollNavi.addClass('draggable-false')}var smooth=$('#control li'),ln=smooth.length,targetPos;if(options.addLast&&ln>1)scrollNavi.children('li').last().addClass('last');$(document).on('click','#control li',function(){var n=smooth.index(this);if(n==0||!options.target){targetPos=0}else{targetPos=$(options.target).eq(n-1).offset().top-options.distance}$('body,html').stop().animate({scrollTop:targetPos},options.speed,options.easing);return false});scrollNavi.children('li').on({'mouseenter':function(){$(this).children(tips).stop(true,true).fadeIn(400)},'mouseleave':function(){$(this).children(tips).delay(200).fadeOut()}});scrollNavi.addClass(options.customClass);var secTopArr=new Array();function positionSearch(){$(options.target).each(function(i){secTopArr[i]=$(this).offset().top})}positionSearch();$(window).scroll(function(){var moved=$(this).scrollTop();for(var i=secTopArr.length-1;i>=0;i--){if($(window).scrollTop()>secTopArr[i]-400){activeChange(i);break}}function activeChange(){smooth.siblings().removeClass('active');if(moved<=secTopArr[0]-200)return;smooth.eq(i+1).addClass('active')}});$.fn.autoSmoothController.cookieInit=function(){navTop=scrollNavi.css('top'),navLeft=scrollNavi.css('left');$.cookie('ascLeft',navLeft.slice(0,-2),{expires:options.period,path:'/'});$.cookie('ascTop',navTop.slice(0,-2),{expires:options.period,path:'/'});$.cookie('windowW',WindowW,{expires:options.period,path:'/'})};$.fn.autoSmoothController.cookieInit();$(window).resize(function(){resizedH=$(window).height(),resizedW=$(window).width();deviceW=resizedW-WindowW;deviceH=resizedH-WindowH;if($.cookie('ascLeft')!==undefined){scrollNavi.css({left:parseInt($.cookie('ascLeft'))+deviceW,top:parseInt($.cookie('ascTop'))+deviceH})}else{scrollNavi.css({left:parseInt(navLeft)+deviceW,top:parseInt(navTop)+deviceH})}navTop=scrollNavi.css('top'),navLeft=scrollNavi.css('left');$.cookie('ascLeft',navLeft.slice(0,-2),{expires:options.period,path:'/'});$.cookie('ascTop',navTop.slice(0,-2),{expires:options.period,path:'/'});WindowH=resizedH;WindowW=resizedW;if(options.stick[0]==true){parentLeft=parentEl.offset().left;stickPosition()}positionSearch();$.cookie('windowW',WindowW,{expires:options.period,path:'/'})});}})(jQuery);
/*!
 * jQuery Cookie Plugin v1.4.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2006, 2014 Klaus Hartl
 * Released under the MIT license
 */
(function(factory){if(typeof define==='function'&&define.amd){define(['jquery'], factory);}else if(typeof exports==='object'){factory(require('jquery'));}else{factory(jQuery);}}(function($){var pluses = /\+/g;function encode(s){return config.raw ? s : encodeURIComponent(s);}function decode(s){return config.raw ? s : decodeURIComponent(s);}function stringifyCookieValue(value){return encode(config.json ? JSON.stringify(value) : String(value));}function parseCookieValue(s){if(s.indexOf('"')===0){s=s.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,'\\');}try {s=decodeURIComponent(s.replace(pluses,' '));return config.json ? JSON.parse(s) : s;}catch(e){}}function read(s,converter){var value=config.raw ? s : parseCookieValue(s);return $.isFunction(converter) ? converter(value) : value;}var config=$.cookie=function(key,value,options){if(arguments.length>1&&!$.isFunction(value)){options=$.extend({},config.defaults,options);if(typeof options.expires==='number'){var days=options.expires,t=options.expires=new Date();t.setTime(+t + days * 864e+5);}return (document.cookie=[encode(key),'=',stringifyCookieValue(value),options.expires ? '; expires='+options.expires.toUTCString() : '', options.path ? '; path='+options.path : '',options.domain ? '; domain='+options.domain : '',options.secure ? '; secure':''].join(''));}var result=key ? undefined : {};var cookies=document.cookie ? document.cookie.split('; ') : [];for (var i=0,l=cookies.length;i<l;i++){var parts = cookies[i].split('=');var name=decode(parts.shift());var cookie=parts.join('=');if(key&&key===name){result=read(cookie,value);break;}if(!key&&(cookie=read(cookie))!==undefined){result[name]=cookie;}}return result;};config.defaults={};$.removeCookie=function(key,options){if($.cookie(key)===undefined){return false;}$.cookie(key,'',$.extend({},options,{ expires: -1 }));return !$.cookie(key);};}));
/*!
 * jQuery UI Touch Punch 0.2.3
 *
 * Copyright 2011–2014, Dave Furfero
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Depends:
 *  jquery.ui.widget.js
 *  jquery.ui.mouse.js
 */
!function(a){function f(a,b){if(!(a.originalEvent.touches.length>1)){a.preventDefault();var c=a.originalEvent.changedTouches[0],d=document.createEvent("MouseEvents");d.initMouseEvent(b,!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null),a.target.dispatchEvent(d)}}if(a.support.touch="ontouchend"in document,a.support.touch){var e,b=a.ui.mouse.prototype,c=b._mouseInit,d=b._mouseDestroy;b._touchStart=function(a){var b=this;!e&&b._mouseCapture(a.originalEvent.changedTouches[0])&&(e=!0,b._touchMoved=!1,f(a,"mouseover"),f(a,"mousemove"),f(a,"mousedown"))},b._touchMove=function(a){e&&(this._touchMoved=!0,f(a,"mousemove"))},b._touchEnd=function(a){e&&(f(a,"mouseup"),f(a,"mouseout"),this._touchMoved||f(a,"click"),e=!1)},b._mouseInit=function(){var b=this;b.element.bind({touchstart:a.proxy(b,"_touchStart"),touchmove:a.proxy(b,"_touchMove"),touchend:a.proxy(b,"_touchEnd")}),c.call(b)},b._mouseDestroy=function(){var b=this;b.element.unbind({touchstart:a.proxy(b,"_touchStart"),touchmove:a.proxy(b,"_touchMove"),touchend:a.proxy(b,"_touchEnd")}),d.call(b)}}}(jQuery);